<!--<!doctype html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KlinikSuite — Admin Paneli</title>
    <style>
        :root {
            --bg: #0f172a;
            --bg-2: #111827;
            --surface: #fff;
            --text: #0b1220;
            --muted: #6b7280;
            --brand: #2563eb;
            --ring: #93c5fd;
            --border: #e5e7eb;
            --success: #16a34a;
            --warn: #d97706;
            --danger: #dc2626;
            --radius: 12px;
            --shadow: 0 8px 30px rgba(2,8,23,.08)
        }

        * {
            box-sizing: border-box
        }

        html, body {
            height: 100%
        }

        body {
            margin: 0;
            background: #f5f7fb;
            color: var(--text);
            font: 14px/1.55 system-ui,-apple-system,Segoe UI,Roboto
        }

        .app {
            display: grid;
            grid-template-columns: 260px 1fr;
            grid-template-rows: 56px 1fr;
            grid-template-areas: "sidebar header" "sidebar main";
            min-height: 100dvh
        }

        aside {
            grid-area: sidebar;
            background: var(--bg);
            color: #e5e7eb;
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 0;
            height: 100dvh;
            border-right: 1px solid rgba(255,255,255,.08)
        }

        .logo {
            display: flex;
            align-items: center;
            gap: .6rem;
            padding: 14px 16px;
            font-weight: 800;
            border-bottom: 1px solid rgba(255,255,255,.06)
        }

        nav {
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px
        }

        .menu-btn {
            appearance: none;
            border: 0;
            background: transparent;
            color: #e5e7eb;
            text-align: left;
            width: 100%;
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700
        }

            .menu-btn:hover {
                background: rgba(255,255,255,.06)
            }

            .menu-btn[aria-current="page"] {
                background: rgba(37,99,235,.18);
                outline: 2px solid rgba(37,99,235,.25)
            }

        header {
            grid-area: header;
            background: var(--bg-2);
            color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            border-bottom: 1px solid rgba(255,255,255,.08)
        }

        .title {
            font-weight: 800
        }

        .input {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 8px 12px
        }

        main {
            grid-area: main;
            padding: 18px
        }

        .panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 16px
        }

        .panel-hd {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .panel-bd {
            padding: 16px
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap
        }

        .btn {
            appearance: none;
            border: 1px solid var(--border);
            background: #fff;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700
        }

            .btn.primary {
                background: var(--brand);
                color: #fff;
                border-color: transparent
            }

            .btn.danger {
                background: var(--danger);
                color: #fff;
                border-color: transparent
            }

            .btn.warn {
                background: var(--warn);
                color: #fff;
                border-color: transparent
            }

            .btn:focus-visible {
                outline: 2px solid var(--ring);
                outline-offset: 2px
            }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0
        }

        thead th {
            font-size: 12px;
            color: var(--muted);
            text-align: left;
            padding: 10px 12px;
            border-bottom: 1px solid var(--border)
        }

        tbody td {
            padding: 12px;
            border-bottom: 1px solid #f1f2f6
        }

        tbody tr:hover {
            background: #fafbff
        }

        .badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid
        }

            .badge.active {
                color: var(--success);
                border-color: var(--success);
                background: #f0fdf4
            }

            .badge.deleted {
                color: var(--danger);
                border-color: var(--danger);
                background: #fef2f2
            }

        dialog {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0;
            max-width: 520px;
            width: 100%
        }

            dialog .d-hd {
                padding: 14px 16px;
                border-bottom: 1px solid var(--border);
                font-weight: 800
            }

            dialog .d-bd {
                padding: 16px;
                display: grid;
                gap: 10px
            }

            dialog .d-ft {
                padding: 12px 16px;
                border-top: 1px solid var(--border);
                display: flex;
                gap: 8px;
                justify-content: flex-end
            }

        label {
            font-weight: 700
        }

        @media(max-width:980px) {
            .app {
                grid-template-columns: 1fr;
                grid-template-rows: 56px 1fr;
                grid-template-areas: "header" "main"
            }

            aside {
                position: fixed;
                inset: 0 auto 0 0;
                width: 280px;
                transform: translateX(-100%);
                transition: .25s;
                z-index: 3
            }

                aside.open {
                    transform: translateX(0)
                }

            .scrim {
                position: fixed;
                inset: 0;
                background: rgba(2,6,23,.45);
                display: none;
                z-index: 2
            }

                .scrim.show {
                    display: block
                }

            .toggle {
                display: inline-flex
            }
        }

        .toggle {
            display: none
        }

        .toast {
            position: fixed;
            right: 16px;
            bottom: 16px;
            background: #111827;
            color: #fff;
            padding: 10px 12px;
            border-radius: 10px;
            opacity: 0;
            transform: translateY(10px);
            transition: .25s
        }

            .toast.show {
                opacity: 1;
                transform: translateY(0)
            }
    </style>
</head>
<body>
    <div class="app">-->
<!-- SIDEBAR -->
<!--<aside id="sidebar" aria-label="Ana menü">
    <div class="logo">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="#60a5fa"><path d="M12 2l9 4.5v10L12 22l-9-5.5v-10L12 2z" /></svg>
        KlinikSuite <span style="opacity:.6;font-weight:700">/ Admin</span>
    </div>
    <nav role="tablist" aria-orientation="vertical">
        <button class="menu-btn" data-target="randevular" aria-current="page">Randevular</button>
        <button class="menu-btn" data-target="hastalar">Hastalar</button>
        <button class="menu-btn" data-target="doktorlar">Doktorlar</button>
    </nav>
    <div style="margin-top:auto;padding:10px 12px;font-size:12px;color:#cbd5e1;border-top:1px solid rgba(255,255,255,.06)">
        v1.0 • Operasyonel mükemmeliyet 🚀
    </div>
</aside>-->
<!-- HEADER -->
<!--<header>
    <div>
        <button class="btn toggle" id="toggleSidebar">☰</button>
        <span class="title" id="pageTitle">Randevular</span>
    </div>
    <div class="toolbar">
        <input class="input" id="globalSearch" type="search" placeholder="Global arama…">
        <button class="btn" id="logoutBtn">Çıkış</button>
    </div>
</header>-->
<!-- MAIN -->
<!--<main id="main">-->
<!-- RANDEVULAR -->
<!--<section id="view-randevular" class="panel" role="tabpanel">
    <div class="panel-hd">
        <strong>Randevular</strong>
        <div class="toolbar">
            <button class="btn primary" id="btnNewAppointment">Yeni Randevu</button>
            <button class="btn" id="btnReloadAppointments">Yenile</button>
        </div>
    </div>
    <div class="panel-bd">
        <table aria-label="Randevu listesi">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>PatientId</th>
                    <th>DoctorId</th>
                    <th>Tarih</th>
                    <th>Saat</th>
                    <th>Status</th>
                    <th align="right">Aksiyon</th>
                </tr>
            </thead>
            <tbody id="tbl-appointments"></tbody>
        </table>
    </div>
</section>-->
<!-- HASTALAR -->
<!--<section id="view-hastalar" class="panel" role="tabpanel" hidden>
    <div class="panel-hd">
        <strong>Hastalar</strong>
        <div class="toolbar">
            <button class="btn primary" id="btnNewPatient">Yeni Hasta</button>
            <button class="btn" id="btnReloadPatients">Yenile</button>
        </div>
    </div>
    <div class="panel-bd">
        <table aria-label="Hasta listesi">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ad Soyad</th>
                    <th>Email</th>
                    <th>Telefon</th>
                </tr>
            </thead>
            <tbody id="tbl-patients"></tbody>
        </table>
    </div>
</section>-->
<!-- DOKTORLAR -->
<!--<section id="view-doktorlar" class="panel" role="tabpanel" hidden>
            <div class="panel-hd">
                <strong>Doktorlar</strong>
                <div class="toolbar">
                    <button class="btn primary" id="btnNewDoctor">Yeni Doktor</button>
                    <button class="btn" id="btnReloadDoctors">Yenile</button>
                </div>
            </div>
            <div class="panel-bd">
                <table aria-label="Doktor listesi">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ad Soyad</th>
                            <th>Uzmanlık</th>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody id="tbl-doctors"></tbody>
                </table>
            </div>
        </section>
    </main>
</div>
<div class="scrim" id="scrim" aria-hidden="true"></div>
<div class="toast" id="toast"></div>-->
<!-- DIALOGS -->
<!--<dialog id="dlg-appointment">
        <div class="d-hd" id="dlg-appointment-title">Yeni Randevu</div>
        <form id="form-appointment" class="d-bd" method="dialog">
            <input type="hidden" id="appointmentId" />
            <label>PatientId <input id="aPatientId" type="number" required /></label>
            <label>DoctorId  <input id="aDoctorId" type="number" required /></label>
            <label>
                Tarih (AppointmentDate)
                <input id="aDate" type="date" required />
            </label>
            <label>
                Saat (AppointmentTime — HH:MM)
                <input id="aTime" type="time" required />
            </label>
            <label>
                Status (1=Aktif, 2=Silinmiş)
                <input id="aStatus" type="number" min="1" max="2" value="1" />
            </label>
        </form>
        <div class="d-ft">
            <button class="btn" id="btnCancelApp">İptal</button>
            <button class="btn primary" id="btnSaveApp">Kaydet</button>
        </div>
    </dialog>

    <dialog id="dlg-patient">
        <div class="d-hd">Yeni Hasta</div>
        <form id="form-patient" class="d-bd" method="dialog">
            <label>Ad Soyad <input id="pFullName" required /></label>
            <label>Email <input id="pEmail" type="email" required /></label>
            <label>Şifre <input id="pPassword" type="password" required /></label>
            <label>Telefon <input id="pPhone" required /></label>
        </form>
        <div class="d-ft">
            <button class="btn" id="btnCancelPatient">İptal</button>
            <button class="btn primary" id="btnSavePatient">Kaydet</button>
        </div>
    </dialog>

    <dialog id="dlg-doctor">
        <div class="d-hd">Yeni Doktor</div>
        <form id="form-doctor" class="d-bd" method="dialog">
            <label>Ad Soyad <input id="dFullName" required /></label>
            <label>Uzmanlık <input id="dSpec" required /></label>
            <label>Email <input id="dEmail" type="email" required /></label>
            <label>Şifre <input id="dPassword" type="password" required /></label>
        </form>
        <div class="d-ft">
            <button class="btn" id="btnCancelDoctor">İptal</button>
            <button class="btn primary" id="btnSaveDoctor">Kaydet</button>
        </div>
    </dialog>

    <script>
/* ==== CONFIG & GUARDS ==== */
const API = "https://localhost:7066/api"; // .NET Web API base (Program.cs CORS açık)
if(localStorage.getItem("isAdminLogged") !== "true"){ location.href = "login.html"; }

/* ==== UTIL ==== */
const qs=(s,r=document)=>r.querySelector(s);
const qsa=(s,r=document)=>[...r.querySelectorAll(s)];
const toastEl=qs('#toast');
function toast(msg){ toastEl.textContent=msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'),2000); }
function fmtDate(d){ // expect ISO
  try{ return new Date(d).toLocaleDateString('tr-TR'); }catch{ return d; }
}
function fmtTime(t){ // expect "HH:MM:SS" or "HH:MM"
  return (t||'').toString().substring(0,5);
}
function statusBadge(v){
  if(+v===2) return '<span class="badge deleted">Silinmiş</span>';
  return '<span class="badge active">Aktif</span>';
}

/* ==== SIDEBAR TOGGLE (mobile) ==== */
const sidebar=qs('#sidebar'), scrim=qs('#scrim'), toggle=qs('#toggleSidebar'), pageTitle=qs('#pageTitle');
function openSidebar(){ sidebar.classList.add('open'); scrim.classList.add('show'); }
function closeSidebar(){ sidebar.classList.remove('open'); scrim.classList.remove('show'); }
toggle?.addEventListener('click',()=> sidebar.classList.contains('open')?closeSidebar():openSidebar());
scrim.addEventListener('click', closeSidebar);

/* ==== LOGOUT ==== */
qs('#logoutBtn').addEventListener('click', ()=>{ localStorage.removeItem('isAdminLogged'); location.href='login.html'; });

/* ==== SEARCH (client side) ==== */
qs('#globalSearch').addEventListener('input', e=>{
  const val = e.target.value.toLowerCase();
  qsa('tbody tr').forEach(tr=> tr.style.display = tr.innerText.toLowerCase().includes(val) ? '' : 'none');
});

/* ==== NAV ==== */
function setActive(target){
  qsa('.menu-btn').forEach(b=>{
    const is = b.dataset.target===target; b.toggleAttribute('aria-current', is);
  });
  qsa('main section').forEach(s=> s.hidden = !s.id.endsWith(target));
  pageTitle.textContent = target[0].toUpperCase()+target.slice(1);
  history.replaceState(null,'','#'+target);
}
qsa('.menu-btn').forEach(b=> b.addEventListener('click', ()=>{ setActive(b.dataset.target); closeSidebar(); loadData(b.dataset.target); }));
setActive((location.hash||'#randevular').slice(1));

/* ==== API CALLS ==== */
// APPOINTMENTS
async function fetchAppointments(){
  const r = await fetch(`${API}/Appointment/getAllAppointments`);
  if(!r.ok) throw new Error(await r.text()||'Randevu alınamadı');
  return r.json();
}
async function fetchAppointmentById(id){
  const r = await fetch(`${API}/Appointment/getAppointmentById`,{
    method:"POST", headers:{'Content-Type':'application/json'}, body: JSON.stringify(id)
  });
  if(!r.ok) throw new Error(await r.text()||'Randevu bulunamadı');
  return r.json();
}
async function createAppointment(payload){ // Appointment
  const r = await fetch(`${API}/Appointment/createAppointment`,{
    method:"POST", headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
  });
  if(!r.ok) throw new Error(await r.text()||'Oluşturulamadı');
  return r.text();
}
async function updateAppointment(payload){ // Appointment
  const r = await fetch(`${API}/Appointment/updateAppointment`,{
    method:"PUT", headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
  });
  if(!r.ok) throw new Error(await r.text()||'Güncellenemedi');
  return r.text();
}
// Soft delete: Servis AppointmentStatus=2 yapıp Update ediyor. Controller PUT ile full entity bekliyor.
// Bu yüzden önce mevcut kaydı çekip statü=2 yaparak geri gönderiyoruz.
async function softDeleteAppointment(id){
  const current = await fetchAppointmentById(id);
  current.AppointmentStatus = 2;
  const r = await fetch(`${API}/Appointment/deleteAppointment`,{
    method:"PUT", headers:{'Content-Type':'application/json'}, body: JSON.stringify(current)
  });
  if(!r.ok) throw new Error(await r.text()||'Silinemedi');
  return r.text();
}

// PATIENTS
async function fetchPatients(){
  const r = await fetch(`${API}/Patient/getAllPatients`);
  if(!r.ok) throw new Error(await r.text()||'Hasta alınamadı');
  return r.json();
}
async function registerPatient(dto){ // PatientRegisterDto
  const r = await fetch(`${API}/Patient/registerPatient`,{
    method:"POST", headers:{'Content-Type':'application/json'}, body: JSON.stringify(dto)
  });
  if(!r.ok) throw new Error(await r.text()||'Hasta kaydı başarısız');
  return r.text();
}

// DOCTORS
async function fetchDoctors(){
  const r = await fetch(`${API}/Doctor/getAllDoctors`);
  if(!r.ok) throw new Error(await r.text()||'Doktor alınamadı');
  return r.json();
}
async function registerDoctor(dto){ // DoctorRegisterDto
  const r = await fetch(`${API}/Doctor/registerDoctor`,{
    method:"POST", headers:{'Content-Type':'application/json'}, body: JSON.stringify(dto)
  });
  if(!r.ok) throw new Error(await r.text()||'Doktor kaydı başarısız');
  return r.text();
}

/* ==== RENDERERS ==== */
async function renderAppointments(){
  const data = await fetchAppointments();
  const tbody = qs('#tbl-appointments'); tbody.innerHTML = '';
  data.forEach(a=>{
    tbody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${a.AppointmentId}</td>
        <td>${a.PatientId}</td>
        <td>${a.DoctorId}</td>
        <td>${fmtDate(a.AppointmentDate)}</td>
        <td>${fmtTime(a.AppointmentTime)}</td>
        <td>${statusBadge(a.AppointmentStatus ?? 1)}</td>
        <td align="right">
          <button class="btn" onclick="openEditAppointment(${a.AppointmentId})">Düzenle</button>
          <button class="btn danger" onclick="confirmDeleteAppointment(${a.AppointmentId})">Sil</button>
        </td>
      </tr>
    `);
  });
}
async function renderPatients(){
  const data = await fetchPatients();
  const tbody = qs('#tbl-patients'); tbody.innerHTML='';
  data.forEach(p=>{
    tbody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${p.PatientId}</td>
        <td>${p.PatientFullName||''}</td>
        <td>${p.PatientEmail||''}</td>
        <td>${p.PatientPhoneNumber||''}</td>
      </tr>
    `);
  });
}
async function renderDoctors(){
  const data = await fetchDoctors();
  const tbody = qs('#tbl-doctors'); tbody.innerHTML='';
  data.forEach(d=>{
    tbody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${d.DoctorId}</td>
        <td>${d.DoctorFullName||''}</td>
        <td>${d.DoctorSpecialization||''}</td>
        <td>${d.DoctorEmail||''}</td>
      </tr>
    `);
  });
}

/* ==== LOAD ON TAB ==== */
async function loadData(target){
  try{
    if(target==='randevular') await renderAppointments();
    if(target==='hastalar') await renderPatients();
    if(target==='doktorlar') await renderDoctors();
  }catch(e){ toast(e.message); console.error(e); }
}
loadData('randevular'); // initial
qs('#btnReloadAppointments').addEventListener('click', ()=>loadData('randevular'));
qs('#btnReloadPatients').addEventListener('click', ()=>loadData('hastalar'));
qs('#btnReloadDoctors').addEventListener('click', ()=>loadData('doktorlar'));

/* ==== DIALOG WIRES ==== */
// Appointment dialog (create/update)
const dlgApp = qs('#dlg-appointment');
qs('#btnNewAppointment').addEventListener('click', ()=>{
  qs('#dlg-appointment-title').textContent='Yeni Randevu';
  qs('#appointmentId').value='';
  qs('#aPatientId').value=''; qs('#aDoctorId').value='';
  qs('#aDate').value=''; qs('#aTime').value=''; qs('#aStatus').value='1';
  dlgApp.showModal();
});
qs('#btnCancelApp').addEventListener('click', ()=> dlgApp.close());

qs('#btnSaveApp').addEventListener('click', async ()=>{
  const id = qs('#appointmentId').value;
  const payload = {
    AppointmentId: id? Number(id): undefined,
    PatientId: Number(qs('#aPatientId').value),
    DoctorId: Number(qs('#aDoctorId').value),
    AppointmentDate: qs('#aDate').value,  // ISO yyyy-mm-dd
    AppointmentTime: qs('#aTime').value + ':00', // TimeSpan "HH:MM:SS"
    AppointmentStatus: Number(qs('#aStatus').value||1)
  };
  try{
    if(id){
      // Update, controller PUT /updateAppointment full entity bekliyor
      await updateAppointment(payload);
      toast('Randevu güncellendi');
    }else{
      await createAppointment(payload);
      toast('Randevu oluşturuldu');
    }
    dlgApp.close();
    renderAppointments();
  }catch(e){ toast(e.message); }
});

// Edit appointment (prefill)
window.openEditAppointment = async function(id){
  try{
    const a = await fetchAppointmentById(id);
    qs('#dlg-appointment-title').textContent='Randevu Düzenle';
    qs('#appointmentId').value = a.AppointmentId;
    qs('#aPatientId').value = a.PatientId;
    qs('#aDoctorId').value = a.DoctorId;
    qs('#aDate').value = (a.AppointmentDate||'').substring(0,10);
    qs('#aTime').value = fmtTime(a.AppointmentTime);
    qs('#aStatus').value = a.AppointmentStatus ?? 1;
    dlgApp.showModal();
  }catch(e){ toast(e.message); }
};

// Soft delete (status=2) with safety
window.confirmDeleteAppointment = async function(id){
  if(!confirm(`#${id} id’li randevu silinsin mi? (Soft delete: status=2)`)) return;
  try{
    await softDeleteAppointment(id);
    toast('Randevu silindi (status=2)');
    renderAppointments();
  }catch(e){ toast(e.message); }
};

// Patient dialog (register)
const dlgPatient = qs('#dlg-patient');
qs('#btnNewPatient').addEventListener('click', ()=> dlgPatient.showModal());
qs('#btnCancelPatient').addEventListener('click', ()=> dlgPatient.close());
qs('#btnSavePatient').addEventListener('click', async ()=>{
  const dto = {
    PatientFullName: qs('#pFullName').value,
    PatientEmail: qs('#pEmail').value,
    PatientPassword: qs('#pPassword').value,
    PatientPhoneNumber: qs('#pPhone').value
  };
  try{
    await registerPatient(dto);
    dlgPatient.close(); toast('Hasta kaydedildi');
    renderPatients();
  }catch(e){ toast(e.message); }
});

// Doctor dialog (register)
const dlgDoctor = qs('#dlg-doctor');
qs('#btnNewDoctor').addEventListener('click', ()=> dlgDoctor.showModal());
qs('#btnCancelDoctor').addEventListener('click', ()=> dlgDoctor.close());
qs('#btnSaveDoctor').addEventListener('click', async ()=>{
  const dto = {
    DoctorFullName: qs('#dFullName').value,
    DoctorSpecialization: qs('#dSpec').value,
    DoctorEmail: qs('#dEmail').value,
    DoctorPassword: qs('#dPassword').value
  };
  try{
    await registerDoctor(dto);
    dlgDoctor.close(); toast('Doktor kaydedildi');
    renderDoctors();
  }catch(e){ toast(e.message); }
});
    </script>
</body>
</html>-->


<!doctype html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="sidebar">
        <h3>Menü</h3>
        <button class="menu-btn" data-target="doktorlar">Doktorlar</button>
        <button class="menu-btn" data-target="hastalar">Hastalar</button>
        <button class="menu-btn" data-target="randevular">Randevular</button>
    </div>

    <div class="content">
        <h2 id="sectionTitle">Hoşgeldiniz</h2>
        <div id="dataContainer"></div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
